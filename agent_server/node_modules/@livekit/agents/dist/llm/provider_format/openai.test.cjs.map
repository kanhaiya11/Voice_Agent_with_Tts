{"version":3,"sources":["../../../src/llm/provider_format/openai.test.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2025 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport { VideoBufferType, VideoFrame } from '@livekit/rtc-node';\nimport { beforeEach, describe, expect, it, vi } from 'vitest';\nimport { initializeLogger } from '../../log.js';\nimport { ChatContext, FunctionCall, FunctionCallOutput } from '../chat_context.js';\nimport { serializeImage } from '../utils.js';\nimport { toChatCtx } from './openai.js';\n\n// Mock the serializeImage function\nvi.mock('../utils.js', () => ({\n  serializeImage: vi.fn(),\n}));\n\ndescribe('toChatCtx', () => {\n  const serializeImageMock = vi.mocked(serializeImage);\n\n  // initialize logger at start of test\n  initializeLogger({ level: 'silent', pretty: false });\n\n  beforeEach(async () => {\n    vi.clearAllMocks();\n  });\n\n  it('should convert simple text messages', async () => {\n    const ctx = ChatContext.empty();\n    ctx.addMessage({ role: 'user', content: 'Hello' });\n    ctx.addMessage({ role: 'assistant', content: 'Hi there!' });\n\n    const result = await toChatCtx(ctx);\n\n    // Messages should be in the result, order may vary due to ID-based sorting\n    expect(result).toHaveLength(2);\n    expect(result[0]).toEqual({ role: 'user', content: 'Hello' });\n    expect(result[1]).toEqual({ role: 'assistant', content: 'Hi there!' });\n  });\n\n  it('should handle system messages', async () => {\n    const ctx = ChatContext.empty();\n    ctx.addMessage({ role: 'system', content: 'You are a helpful assistant' });\n    ctx.addMessage({ role: 'user', content: 'Hello' });\n\n    const result = await toChatCtx(ctx);\n\n    // Messages should be in the result, order may vary due to ID-based sorting\n    expect(result).toHaveLength(2);\n    expect(result[0]).toEqual({ role: 'system', content: 'You are a helpful assistant' });\n    expect(result[1]).toEqual({ role: 'user', content: 'Hello' });\n  });\n\n  it('should handle multi-line text content', async () => {\n    const ctx = ChatContext.empty();\n    ctx.addMessage({ role: 'user', content: ['Line 1', 'Line 2', 'Line 3'] });\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toHaveLength(1);\n    expect(result[0]).toEqual({ role: 'user', content: 'Line 1\\nLine 2\\nLine 3' });\n  });\n\n  it('should handle messages with external URL images', async () => {\n    serializeImageMock.mockResolvedValue({\n      inferenceDetail: 'high',\n      externalUrl: 'https://example.com/image.jpg',\n    });\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'user',\n      content: [\n        'Check out this image:',\n        {\n          id: 'img1',\n          type: 'image_content',\n          image: 'https://example.com/image.jpg',\n          inferenceDetail: 'high',\n          _cache: {},\n        },\n      ],\n    });\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'user',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: 'https://example.com/image.jpg',\n              detail: 'high',\n            },\n          },\n          { type: 'text', text: 'Check out this image:' },\n        ],\n      },\n    ]);\n  });\n\n  it('should handle messages with base64 images', async () => {\n    serializeImageMock.mockResolvedValue({\n      inferenceDetail: 'auto',\n      mimeType: 'image/png',\n      base64Data: 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAAB',\n    });\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'assistant',\n      content: [\n        {\n          id: 'img1',\n          type: 'image_content',\n          image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAB',\n          inferenceDetail: 'auto',\n          _cache: {},\n        },\n        'Here is the image you requested',\n      ],\n    });\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'assistant',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAB',\n              detail: 'auto',\n            },\n          },\n          { type: 'text', text: 'Here is the image you requested' },\n        ],\n      },\n    ]);\n  });\n\n  it('should handle VideoFrame images', async () => {\n    serializeImageMock.mockResolvedValue({\n      inferenceDetail: 'low',\n      mimeType: 'image/jpeg',\n      base64Data: '/9j/4AAQSkZJRg==',\n    });\n\n    const frameData = new Uint8Array(4 * 4 * 4); // 4x4 RGBA\n    const videoFrame = new VideoFrame(frameData, 4, 4, VideoBufferType.RGBA);\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'user',\n      content: [\n        {\n          id: 'frame1',\n          type: 'image_content',\n          image: videoFrame,\n          inferenceDetail: 'low',\n          _cache: {},\n        },\n      ],\n    });\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'user',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: 'data:image/jpeg;base64,/9j/4AAQSkZJRg==',\n              detail: 'low',\n            },\n          },\n        ],\n      },\n    ]);\n  });\n\n  it('should cache serialized images', async () => {\n    serializeImageMock.mockResolvedValue({\n      inferenceDetail: 'high',\n      mimeType: 'image/png',\n      base64Data: 'cached-data',\n    });\n\n    const imageContent = {\n      id: 'img1',\n      type: 'image_content' as const,\n      image: 'https://example.com/image.jpg',\n      inferenceDetail: 'high' as const,\n      _cache: {},\n    };\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({ role: 'user', content: [imageContent] });\n\n    // Call twice to test caching\n    await toChatCtx(ctx);\n    await toChatCtx(ctx);\n\n    // serializeImage should only be called once due to caching\n    expect(serializeImageMock).toHaveBeenCalledTimes(1);\n    expect(imageContent._cache).toHaveProperty('serialized_image');\n  });\n\n  it('should handle tool calls and outputs', async () => {\n    const ctx = ChatContext.empty();\n\n    // Add an assistant message with tool calls\n    const msg = ctx.addMessage({ role: 'assistant', content: 'Let me help you with that.' });\n    const toolCall = FunctionCall.create({\n      id: msg.id + '/tool_1',\n      callId: 'call_123',\n      name: 'get_weather',\n      args: '{\"location\": \"San Francisco\"}',\n    });\n    const toolOutput = FunctionCallOutput.create({\n      callId: 'call_123',\n      output: '{\"temperature\": 72, \"condition\": \"sunny\"}',\n      isError: false,\n    });\n\n    ctx.insert([toolCall, toolOutput]);\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'assistant',\n        content: 'Let me help you with that.',\n        tool_calls: [\n          {\n            type: 'function',\n            id: 'call_123',\n            function: {\n              name: 'get_weather',\n              arguments: '{\"location\": \"San Francisco\"}',\n            },\n          },\n        ],\n      },\n      {\n        role: 'tool',\n        tool_call_id: 'call_123',\n        content: '{\"temperature\": 72, \"condition\": \"sunny\"}',\n      },\n    ]);\n  });\n\n  it('should handle multiple tool calls in one message', async () => {\n    const ctx = ChatContext.empty();\n\n    const msg = ctx.addMessage({ role: 'assistant', content: \"I'll check both locations.\" });\n    const toolCall1 = new FunctionCall({\n      id: msg.id + '/tool_1',\n      callId: 'call_1',\n      name: 'get_weather',\n      args: '{\"location\": \"NYC\"}',\n    });\n    const toolCall2 = new FunctionCall({\n      id: msg.id + '/tool_2',\n      callId: 'call_2',\n      name: 'get_weather',\n      args: '{\"location\": \"LA\"}',\n    });\n    const toolOutput1 = new FunctionCallOutput({\n      callId: 'call_1',\n      output: '{\"temperature\": 65}',\n      isError: false,\n    });\n    const toolOutput2 = new FunctionCallOutput({\n      callId: 'call_2',\n      output: '{\"temperature\": 78}',\n      isError: false,\n    });\n\n    ctx.insert([toolCall1, toolCall2, toolOutput1, toolOutput2]);\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'assistant',\n        content: \"I'll check both locations.\",\n        tool_calls: [\n          {\n            type: 'function',\n            id: 'call_1',\n            function: { name: 'get_weather', arguments: '{\"location\": \"NYC\"}' },\n          },\n          {\n            type: 'function',\n            id: 'call_2',\n            function: { name: 'get_weather', arguments: '{\"location\": \"LA\"}' },\n          },\n        ],\n      },\n      {\n        role: 'tool',\n        tool_call_id: 'call_1',\n        content: '{\"temperature\": 65}',\n      },\n      {\n        role: 'tool',\n        tool_call_id: 'call_2',\n        content: '{\"temperature\": 78}',\n      },\n    ]);\n  });\n\n  it('should handle tool calls without accompanying message', async () => {\n    const ctx = ChatContext.empty();\n\n    const toolCall = new FunctionCall({\n      id: 'func_123',\n      callId: 'call_456',\n      name: 'calculate',\n      args: '{\"a\": 5, \"b\": 3}',\n    });\n    const toolOutput = new FunctionCallOutput({\n      callId: 'call_456',\n      output: '{\"result\": 8}',\n      isError: false,\n    });\n\n    ctx.insert([toolCall, toolOutput]);\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'assistant',\n        tool_calls: [\n          {\n            type: 'function',\n            id: 'call_456',\n            function: { name: 'calculate', arguments: '{\"a\": 5, \"b\": 3}' },\n          },\n        ],\n      },\n      {\n        role: 'tool',\n        tool_call_id: 'call_456',\n        content: '{\"result\": 8}',\n      },\n    ]);\n  });\n\n  it('should skip empty groups', async () => {\n    const ctx = ChatContext.empty();\n    ctx.addMessage({ role: 'user', content: 'Hello', createdAt: 1000 });\n\n    // Create an isolated tool output without corresponding call (will be filtered)\n    const orphanOutput = new FunctionCallOutput({\n      callId: 'orphan_call',\n      output: 'This should be ignored',\n      isError: false,\n      createdAt: 2000,\n    });\n    ctx.insert(orphanOutput);\n\n    ctx.addMessage({ role: 'assistant', content: 'Hi!', createdAt: 3000 });\n\n    const result = await toChatCtx(ctx);\n\n    // Messages should be in the result, orphan output should be filtered out\n    expect(result).toHaveLength(2);\n    expect(result).toContainEqual({ role: 'user', content: 'Hello' });\n    expect(result).toContainEqual({ role: 'assistant', content: 'Hi!' });\n  });\n\n  it('should handle mixed content with text and multiple images', async () => {\n    serializeImageMock\n      .mockResolvedValueOnce({\n        inferenceDetail: 'high',\n        externalUrl: 'https://example.com/image1.jpg',\n      })\n      .mockResolvedValueOnce({\n        inferenceDetail: 'low',\n        mimeType: 'image/png',\n        base64Data: 'base64data',\n      });\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'user',\n      content: [\n        'Here are two images:',\n        {\n          id: 'img1',\n          type: 'image_content',\n          image: 'https://example.com/image1.jpg',\n          inferenceDetail: 'high',\n          _cache: {},\n        },\n        'And the second one:',\n        {\n          id: 'img2',\n          type: 'image_content',\n          image: 'data:image/png;base64,base64data',\n          inferenceDetail: 'low',\n          _cache: {},\n        },\n        'What do you think?',\n      ],\n    });\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'user',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: 'https://example.com/image1.jpg',\n              detail: 'high',\n            },\n          },\n          {\n            type: 'image_url',\n            image_url: {\n              url: 'data:image/png;base64,base64data',\n              detail: 'low',\n            },\n          },\n          {\n            type: 'text',\n            text: 'Here are two images:\\nAnd the second one:\\nWhat do you think?',\n          },\n        ],\n      },\n    ]);\n  });\n\n  it('should handle content with only images and no text', async () => {\n    serializeImageMock.mockResolvedValue({\n      inferenceDetail: 'auto',\n      externalUrl: 'https://example.com/image.jpg',\n    });\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'user',\n      content: [\n        {\n          id: 'img1',\n          type: 'image_content',\n          image: 'https://example.com/image.jpg',\n          inferenceDetail: 'auto',\n          _cache: {},\n        },\n      ],\n    });\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'user',\n        content: [\n          {\n            type: 'image_url',\n            image_url: {\n              url: 'https://example.com/image.jpg',\n              detail: 'auto',\n            },\n          },\n        ],\n      },\n    ]);\n  });\n\n  it('should throw error for unsupported content type', async () => {\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'user',\n      content: [\n        {\n          type: 'audio_content',\n          frame: [],\n        },\n      ],\n    });\n\n    await expect(toChatCtx(ctx)).rejects.toThrow('Unsupported content type: audio_content');\n  });\n\n  it('should throw error when serialized image has no data', async () => {\n    serializeImageMock.mockResolvedValue({\n      inferenceDetail: 'high',\n      // No base64Data or externalUrl\n    });\n\n    const ctx = ChatContext.empty();\n    ctx.addMessage({\n      role: 'user',\n      content: [\n        {\n          id: 'img1',\n          type: 'image_content',\n          image: 'invalid-image',\n          inferenceDetail: 'high',\n          _cache: {},\n        },\n      ],\n    });\n\n    await expect(toChatCtx(ctx)).rejects.toThrow('Serialized image has no data bytes');\n  });\n\n  it('should filter out standalone function calls without outputs', async () => {\n    const ctx = ChatContext.empty();\n\n    // Add standalone function call without output\n    const funcCall = new FunctionCall({\n      id: 'func_standalone',\n      callId: 'call_999',\n      name: 'standalone_function',\n      args: '{}',\n    });\n\n    ctx.insert(funcCall);\n\n    const result = await toChatCtx(ctx);\n\n    // Standalone function calls without outputs are filtered out by groupToolCalls\n    expect(result).toEqual([]);\n  });\n\n  it('should handle function call output correctly', async () => {\n    const ctx = ChatContext.empty();\n\n    // First add a function call\n    const funcCall = new FunctionCall({\n      id: 'func_1',\n      callId: 'call_output_test',\n      name: 'test_function',\n      args: '{}',\n    });\n\n    // Then add its output\n    const funcOutput = new FunctionCallOutput({\n      callId: 'call_output_test',\n      output: 'Function executed successfully',\n      isError: false,\n    });\n\n    ctx.insert([funcCall, funcOutput]);\n\n    const result = await toChatCtx(ctx);\n\n    expect(result).toEqual([\n      {\n        role: 'assistant',\n        tool_calls: [\n          {\n            id: 'call_output_test',\n            type: 'function',\n            function: {\n              name: 'test_function',\n              arguments: '{}',\n            },\n          },\n        ],\n      },\n      {\n        role: 'tool',\n        tool_call_id: 'call_output_test',\n        content: 'Function executed successfully',\n      },\n    ]);\n  });\n});\n"],"mappings":"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","names":[]}