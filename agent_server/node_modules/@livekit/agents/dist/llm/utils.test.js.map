{"version":3,"sources":["../../src/llm/utils.test.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2025 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport { VideoBufferType, VideoFrame } from '@livekit/rtc-node';\nimport sharp from 'sharp';\nimport { beforeEach, describe, expect, it, vi } from 'vitest';\nimport { ChatContext, ChatMessage, type ImageContent } from './chat_context.js';\nimport { computeChatCtxDiff, serializeImage } from './utils.js';\n\nfunction createChatMessage(\n  id: string,\n  content: string,\n  role: 'user' | 'assistant' | 'system' = 'user',\n): ChatMessage {\n  return ChatMessage.create({\n    id,\n    content,\n    role,\n  });\n}\n\nfunction createChatContext(messages: ChatMessage[]): ChatContext {\n  const ctx = new ChatContext();\n  for (const message of messages) {\n    ctx.items.push(message);\n  }\n  return ctx;\n}\n\nfunction createImageContent(\n  image: string | VideoFrame,\n  inferenceDetail: 'auto' | 'high' | 'low' = 'auto',\n  options?: {\n    mimeType?: string;\n    inferenceWidth?: number;\n    inferenceHeight?: number;\n  },\n): ImageContent {\n  return {\n    id: 'test-id',\n    type: 'image_content',\n    image,\n    inferenceDetail,\n    mimeType: options?.mimeType,\n    inferenceWidth: options?.inferenceWidth,\n    inferenceHeight: options?.inferenceHeight,\n    _cache: {},\n  };\n}\n\nasync function decodeImageToRaw(base64Data: string) {\n  const imageBuffer = Buffer.from(base64Data, 'base64');\n  const decodedImage = await sharp(imageBuffer).raw().toBuffer({ resolveWithObject: true });\n  return { imageBuffer, decodedImage };\n}\n\nfunction createSolidColorFrame(\n  width: number,\n  height: number,\n  color: { r: number; g: number; b: number; a?: number },\n  bufferType: VideoBufferType = VideoBufferType.RGBA,\n): VideoFrame {\n  const channels = bufferType === VideoBufferType.RGB24 ? 3 : 4;\n  const frameData = new Uint8Array(width * height * channels);\n\n  for (let i = 0; i < frameData.length; i += channels) {\n    frameData[i] = color.r;\n    frameData[i + 1] = color.g;\n    frameData[i + 2] = color.b;\n    if (channels === 4 && color.a !== undefined) {\n      frameData[i + 3] = color.a;\n    }\n  }\n\n  return new VideoFrame(frameData, width, height, bufferType);\n}\n\nfunction createGradientFrame(width: number, height: number): VideoFrame {\n  const channels = 4;\n  const frameData = new Uint8Array(width * height * channels);\n\n  for (let y = 0; y < height; y++) {\n    for (let x = 0; x < width; x++) {\n      const idx = (y * width + x) * channels;\n      frameData[idx] = Math.floor((x / (width - 1)) * 255);\n      frameData[idx + 1] = Math.floor((y / (height - 1)) * 255);\n      frameData[idx + 2] = 128;\n      frameData[idx + 3] = 255;\n    }\n  }\n\n  return new VideoFrame(frameData, width, height, VideoBufferType.RGBA);\n}\n\nfunction createPatternFrame(width: number, height: number, patterns: number[][]): VideoFrame {\n  const channels = 4;\n  const frameData = new Uint8Array(width * height * channels);\n\n  for (let i = 0; i < patterns.length; i++) {\n    const offset = i * 4;\n    const pattern = patterns[i]!;\n    frameData[offset] = pattern[0]!;\n    frameData[offset + 1] = pattern[1]!;\n    frameData[offset + 2] = pattern[2]!;\n    frameData[offset + 3] = pattern[3]!;\n  }\n\n  return new VideoFrame(frameData, width, height, VideoBufferType.RGBA);\n}\n\nfunction verifyPngHeader(imageBuffer: Buffer) {\n  expect(imageBuffer[0]).toBe(0x89);\n  expect(imageBuffer[1]).toBe(0x50);\n  expect(imageBuffer[2]).toBe(0x4e);\n  expect(imageBuffer[3]).toBe(0x47);\n}\n\nfunction expectPixel(\n  data: Buffer,\n  index: number,\n  expected: { r: number; g: number; b: number; a: number },\n) {\n  expect(data[index]).toBe(expected.r);\n  expect(data[index + 1]).toBe(expected.g);\n  expect(data[index + 2]).toBe(expected.b);\n  expect(data[index + 3]).toBe(expected.a);\n}\n\ndescribe('computeChatCtxDiff', () => {\n  it('should return empty operations for identical contexts', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n\n    const oldCtx = createChatContext([msg1, msg2]);\n    const newCtx = createChatContext([msg1, msg2]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle empty old context', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n\n    const oldCtx = createChatContext([]);\n    const newCtx = createChatContext([msg1, msg2]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([\n      [null, '1'], // first item goes to root\n      ['1', '2'],\n    ]);\n  });\n\n  it('should handle empty new context', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n\n    const oldCtx = createChatContext([msg1, msg2]);\n    const newCtx = createChatContext([]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual(['1', '2']);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle adding items to the end', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n\n    const oldCtx = createChatContext([msg1, msg2]);\n    const newCtx = createChatContext([msg1, msg2, msg3]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([['2', '3']]);\n  });\n\n  it('should handle removing items from the end', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n\n    const oldCtx = createChatContext([msg1, msg2, msg3]);\n    const newCtx = createChatContext([msg1, msg2]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual(['3']);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle adding items to the beginning', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n\n    const oldCtx = createChatContext([msg2, msg3]);\n    const newCtx = createChatContext([msg1, msg2, msg3]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([[null, '1']]);\n  });\n\n  it('should handle removing items from the beginning', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n\n    const oldCtx = createChatContext([msg1, msg2, msg3]);\n    const newCtx = createChatContext([msg2, msg3]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual(['1']);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle adding items in the middle', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n    const msg4 = createChatMessage('4', 'Fine thanks', 'assistant');\n\n    const oldCtx = createChatContext([msg1, msg3, msg4]);\n    const newCtx = createChatContext([msg1, msg2, msg3, msg4]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([['1', '2']]);\n  });\n\n  it('should handle removing items from the middle', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n    const msg4 = createChatMessage('4', 'Fine thanks', 'assistant');\n\n    const oldCtx = createChatContext([msg1, msg2, msg3, msg4]);\n    const newCtx = createChatContext([msg1, msg3, msg4]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual(['2']);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle complex mixed operations', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n    const msg4 = createChatMessage('4', 'Fine thanks', 'assistant');\n    const msg5 = createChatMessage('5', 'Good to hear', 'user');\n    const msg6 = createChatMessage('6', 'Anything else?', 'assistant');\n\n    // Old: [1, 2, 3, 4]\n    // New: [1, 5, 3, 6]\n    // Remove: [2, 4]\n    // Create: [5 after 1, 6 after 3]\n\n    const oldCtx = createChatContext([msg1, msg2, msg3, msg4]);\n    const newCtx = createChatContext([msg1, msg5, msg3, msg6]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual(['2', '4']);\n    expect(result.toCreate).toEqual([\n      ['1', '5'],\n      ['3', '6'],\n    ]);\n  });\n\n  it('should handle reordering items', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n\n    // Old: [1, 2, 3]\n    // New: [3, 1, 2]\n    // This should remove all and recreate in new order\n\n    const oldCtx = createChatContext([msg1, msg2, msg3]);\n    const newCtx = createChatContext([msg3, msg1, msg2]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    // Since order changed completely, should have some operations\n    expect(result.toRemove.length + result.toCreate.length).toBeGreaterThan(0);\n  });\n\n  it('should handle identical single item contexts', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n\n    const oldCtx = createChatContext([msg1]);\n    const newCtx = createChatContext([msg1]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle longest common subsequence correctly', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n    const msg4 = createChatMessage('4', 'Fine thanks', 'assistant');\n    const msg5 = createChatMessage('5', 'Good to hear', 'user');\n\n    // Old: [1, 2, 3, 4, 5]\n    // New: [1, 3, 5]\n    // LCS should be [1, 3, 5], remove [2, 4]\n\n    const oldCtx = createChatContext([msg1, msg2, msg3, msg4, msg5]);\n    const newCtx = createChatContext([msg1, msg3, msg5]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual(['2', '4']);\n    expect(result.toCreate).toEqual([]);\n  });\n\n  it('should handle interleaved additions and common subsequence', () => {\n    const msg1 = createChatMessage('1', 'Hello', 'user');\n    const msg2 = createChatMessage('2', 'Hi there', 'assistant');\n    const msg3 = createChatMessage('3', 'How are you?', 'user');\n    const msg4 = createChatMessage('4', 'Fine thanks', 'assistant');\n    const msg5 = createChatMessage('5', 'Good to hear', 'user');\n    const msg6 = createChatMessage('6', 'Anything else?', 'assistant');\n\n    // Old: [1, 3, 5]\n    // New: [1, 2, 3, 4, 5, 6]\n    // LCS: [1, 3, 5], add [2 after 1, 4 after 3, 6 after 5]\n\n    const oldCtx = createChatContext([msg1, msg3, msg5]);\n    const newCtx = createChatContext([msg1, msg2, msg3, msg4, msg5, msg6]);\n\n    const result = computeChatCtxDiff(oldCtx, newCtx);\n\n    expect(result.toRemove).toEqual([]);\n    expect(result.toCreate).toEqual([\n      ['1', '2'],\n      ['3', '4'],\n      ['5', '6'],\n    ]);\n  });\n});\n\ndescribe('serializeImage', () => {\n  let consoleWarnSpy: ReturnType<typeof vi.spyOn>;\n\n  beforeEach(() => {\n    consoleWarnSpy = vi.spyOn(console, 'warn').mockImplementation(() => {});\n    vi.clearAllMocks();\n  });\n\n  describe('Data URL handling', () => {\n    it('should serialize a valid JPEG data URL', async () => {\n      const originalBase64 = '/9j/4AAQSkZJRg==';\n      const imageContent = createImageContent(`data:image/jpeg;base64,${originalBase64}`, 'high');\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toEqual({\n        base64Data: originalBase64,\n        mimeType: 'image/jpeg',\n        inferenceDetail: 'high',\n      });\n\n      expect(result.base64Data).toBe(originalBase64);\n    });\n\n    it('should serialize a valid PNG data URL', async () => {\n      const imageContent = createImageContent(\n        'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAB',\n        'low',\n      );\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toEqual({\n        base64Data: 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAAB',\n        mimeType: 'image/png',\n        inferenceDetail: 'low',\n      });\n    });\n\n    it('should serialize a valid WebP data URL', async () => {\n      const imageContent = createImageContent(\n        'data:image/webp;base64,UklGRiQAAABXRUJQVlA4IBgAAAA',\n        'auto',\n      );\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toEqual({\n        base64Data: 'UklGRiQAAABXRUJQVlA4IBgAAAA',\n        mimeType: 'image/webp',\n        inferenceDetail: 'auto',\n      });\n    });\n\n    it('should serialize a valid GIF data URL', async () => {\n      const imageContent = createImageContent(\n        'data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',\n        'auto',\n      );\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toEqual({\n        base64Data: 'R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==',\n        mimeType: 'image/gif',\n        inferenceDetail: 'auto',\n      });\n    });\n\n    it('should warn and use provided mimeType when it differs from data URL mime type', async () => {\n      const imageContent = createImageContent('data:image/jpeg;base64,/9j/4AAQSkZJRg==', 'auto', {\n        mimeType: 'image/png',\n      });\n\n      const result = await serializeImage(imageContent);\n\n      expect(consoleWarnSpy).toHaveBeenCalledWith(\n        \"Provided mimeType 'image/png' does not match data URL mime type 'image/jpeg'. Using provided mimeType.\",\n      );\n      expect(result).toEqual({\n        base64Data: '/9j/4AAQSkZJRg==',\n        mimeType: 'image/png',\n        inferenceDetail: 'auto',\n      });\n    });\n\n    it('should throw error for invalid data URL format', async () => {\n      const imageContent = createImageContent('data:;base64,/9j/4AAQSkZJRg==', 'auto');\n\n      await expect(serializeImage(imageContent)).rejects.toThrow('Invalid data URL format');\n    });\n\n    it('should throw error for unsupported mime type', async () => {\n      const imageContent = createImageContent(\n        'data:image/bmp;base64,Qk06AAAAAAAAADYAAAAoAAAA',\n        'auto',\n      );\n\n      await expect(serializeImage(imageContent)).rejects.toThrow(\n        'Unsupported mimeType image/bmp. Must be jpeg, png, webp, or gif',\n      );\n    });\n  });\n\n  describe('External URL handling', () => {\n    it('should serialize an external URL without mimeType', async () => {\n      const imageContent = createImageContent('https://example.com/image.jpg', 'high');\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toEqual({\n        mimeType: undefined,\n        inferenceDetail: 'high',\n        externalUrl: 'https://example.com/image.jpg',\n      });\n    });\n\n    it('should serialize an external URL with mimeType', async () => {\n      const imageContent = createImageContent('https://example.com/image.jpg', 'low', {\n        mimeType: 'image/jpeg',\n      });\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toEqual({\n        mimeType: 'image/jpeg',\n        inferenceDetail: 'low',\n        externalUrl: 'https://example.com/image.jpg',\n      });\n    });\n  });\n\n  describe('VideoFrame handling', () => {\n    it('should serialize a VideoFrame without resize parameters', async () => {\n      const width = 4;\n      const height = 4;\n      const videoFrame = createSolidColorFrame(width, height, { r: 255, g: 0, b: 0, a: 255 });\n      const imageContent = createImageContent(videoFrame, 'auto');\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toMatchObject({\n        mimeType: 'image/png',\n        inferenceDetail: 'auto',\n      });\n      expect(result.base64Data).toBeDefined();\n      expect(result.base64Data).toMatch(/^[A-Za-z0-9+/]+=*$/);\n      expect(result.externalUrl).toBeUndefined();\n\n      const { imageBuffer, decodedImage } = await decodeImageToRaw(result.base64Data!);\n\n      verifyPngHeader(imageBuffer);\n\n      expect(decodedImage.info.width).toBe(width);\n      expect(decodedImage.info.height).toBe(height);\n      expect(decodedImage.info.channels).toBe(4);\n\n      const decodedData = decodedImage.data;\n      for (let i = 0; i < decodedData.length; i += 4) {\n        expectPixel(decodedData, i, { r: 255, g: 0, b: 0, a: 255 });\n      }\n    });\n\n    it('should serialize a VideoFrame with a gradient pattern', async () => {\n      const width = 8;\n      const height = 8;\n      const videoFrame = createGradientFrame(width, height);\n      const imageContent = createImageContent(videoFrame, 'high');\n\n      const result = await serializeImage(imageContent);\n\n      expect(result).toMatchObject({\n        mimeType: 'image/png',\n        inferenceDetail: 'high',\n      });\n\n      const { decodedImage } = await decodeImageToRaw(result.base64Data!);\n\n      expect(decodedImage.info.width).toBe(width);\n      expect(decodedImage.info.height).toBe(height);\n\n      const decodedData = decodedImage.data;\n\n      for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n          const idx = (y * width + x) * 4;\n          const expectedR = Math.floor((x / (width - 1)) * 255);\n          const expectedG = Math.floor((y / (height - 1)) * 255);\n\n          expectPixel(decodedData, idx, { r: expectedR, g: expectedG, b: 128, a: 255 });\n        }\n      }\n    });\n\n    it('should preserve exact pixel data through serialization', async () => {\n      const width = 2;\n      const height = 2;\n\n      const patterns = [\n        [255, 0, 0, 255],\n        [0, 255, 0, 255],\n        [0, 0, 255, 255],\n        [255, 255, 255, 255],\n      ];\n\n      const videoFrame = createPatternFrame(width, height, patterns);\n      const imageContent = createImageContent(videoFrame, 'low');\n\n      const result = await serializeImage(imageContent);\n\n      const { decodedImage } = await decodeImageToRaw(result.base64Data!);\n      const decoded = decodedImage.data;\n\n      expectPixel(decoded, 0, { r: 255, g: 0, b: 0, a: 255 });\n      expectPixel(decoded, 4, { r: 0, g: 255, b: 0, a: 255 });\n      expectPixel(decoded, width * 4, { r: 0, g: 0, b: 255, a: 255 });\n      expectPixel(decoded, (width + 1) * 4, { r: 255, g: 255, b: 255, a: 255 });\n    });\n\n    it('should handle resize parameters correctly', async () => {\n      const width = 2;\n      const height = 2;\n      const videoFrame = createSolidColorFrame(width, height, { r: 100, g: 100, b: 100, a: 255 });\n\n      const imageContent = createImageContent(videoFrame, 'auto', {\n        inferenceWidth: 4,\n        inferenceHeight: 4,\n      });\n\n      const result = await serializeImage(imageContent);\n\n      const { decodedImage } = await decodeImageToRaw(result.base64Data!);\n\n      expect(decodedImage.info.width).toBe(4);\n      expect(decodedImage.info.height).toBe(4);\n\n      const decodedData = decodedImage.data;\n      for (let i = 0; i < decodedData.length; i += 4) {\n        expect(decodedData[i]).toBeCloseTo(100, -1);\n        expect(decodedData[i + 1]).toBeCloseTo(100, -1);\n        expect(decodedData[i + 2]).toBeCloseTo(100, -1);\n        expect(decodedData[i + 3]).toBe(255);\n      }\n    });\n\n    it('should handle RGB24 VideoBufferType correctly', async () => {\n      const width = 2;\n      const height = 2;\n      const channels = 3;\n      const frameData = new Uint8Array(width * height * channels);\n\n      for (let i = 0; i < frameData.length; i += channels) {\n        frameData[i] = 255;\n        frameData[i + 1] = 128;\n        frameData[i + 2] = 64;\n      }\n\n      const videoFrame = new VideoFrame(frameData, width, height, VideoBufferType.RGB24);\n      const imageContent = createImageContent(videoFrame, 'auto');\n\n      const result = await serializeImage(imageContent);\n\n      expect(result.mimeType).toBe('image/png');\n\n      const { decodedImage } = await decodeImageToRaw(result.base64Data!);\n\n      expect(decodedImage.info.channels).toBeGreaterThanOrEqual(3);\n\n      const decodedData = decodedImage.data;\n      const decodedChannels = decodedImage.info.channels;\n\n      for (let i = 0; i < decodedData.length; i += decodedChannels) {\n        expect(decodedData[i]).toBe(255);\n        expect(decodedData[i + 1]).toBe(128);\n        expect(decodedData[i + 2]).toBe(64);\n        if (decodedChannels === 4) {\n          expect(decodedData[i + 3]).toBe(255);\n        }\n      }\n    });\n\n    it('should handle different RGBA-like formats correctly', async () => {\n      const width = 1;\n      const height = 1;\n      const testFormats = [\n        VideoBufferType.RGBA,\n        VideoBufferType.BGRA,\n        VideoBufferType.ARGB,\n        VideoBufferType.ABGR,\n      ];\n\n      for (const format of testFormats) {\n        const frameData = new Uint8Array([100, 150, 200, 250]);\n        const videoFrame = new VideoFrame(frameData, width, height, format);\n        const imageContent = createImageContent(videoFrame, 'auto');\n\n        const result = await serializeImage(imageContent);\n\n        expect(result.mimeType).toBe('image/png');\n        expect(result.base64Data).toBeDefined();\n      }\n    });\n  });\n\n  describe('Error handling', () => {\n    it('should throw error for unsupported image type', async () => {\n      const imageContent = createImageContent(123 as any, 'auto'); // eslint-disable-line @typescript-eslint/no-explicit-any\n\n      await expect(serializeImage(imageContent)).rejects.toThrow('Unsupported image type');\n    });\n  });\n});\n"],"mappings":"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","names":[]}