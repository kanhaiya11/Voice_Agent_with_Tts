{"version":3,"sources":["../../src/metrics/usage_collector.ts"],"sourcesContent":["// SPDX-FileCopyrightText: 2024 LiveKit, Inc.\n//\n// SPDX-License-Identifier: Apache-2.0\nimport type { AgentMetrics } from './base.js';\n\nexport interface UsageSummary {\n  llmPromptTokens: number;\n  llmPromptCachedTokens: number;\n  llmCompletionTokens: number;\n  ttsCharactersCount: number;\n  sttAudioDuration: number;\n}\n\nexport class UsageCollector {\n  private summary: UsageSummary;\n\n  constructor() {\n    this.summary = {\n      llmPromptTokens: 0,\n      llmPromptCachedTokens: 0,\n      llmCompletionTokens: 0,\n      ttsCharactersCount: 0,\n      sttAudioDuration: 0,\n    };\n  }\n\n  collect(metrics: AgentMetrics): void {\n    if (metrics.type === 'llm_metrics') {\n      this.summary.llmPromptTokens += metrics.promptTokens;\n      this.summary.llmPromptCachedTokens += metrics.promptCachedTokens;\n      this.summary.llmCompletionTokens += metrics.completionTokens;\n    } else if (metrics.type === 'realtime_model_metrics') {\n      this.summary.llmPromptTokens += metrics.inputTokens;\n      this.summary.llmPromptCachedTokens += metrics.inputTokenDetails.cachedTokens;\n      this.summary.llmCompletionTokens += metrics.outputTokens;\n    } else if (metrics.type === 'tts_metrics') {\n      this.summary.ttsCharactersCount += metrics.charactersCount;\n    } else if (metrics.type === 'stt_metrics') {\n      this.summary.sttAudioDuration += metrics.audioDuration;\n    }\n  }\n\n  getSummary(): UsageSummary {\n    return { ...this.summary };\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAaO,MAAM,eAAe;AAAA,EAClB;AAAA,EAER,cAAc;AACZ,SAAK,UAAU;AAAA,MACb,iBAAiB;AAAA,MACjB,uBAAuB;AAAA,MACvB,qBAAqB;AAAA,MACrB,oBAAoB;AAAA,MACpB,kBAAkB;AAAA,IACpB;AAAA,EACF;AAAA,EAEA,QAAQ,SAA6B;AACnC,QAAI,QAAQ,SAAS,eAAe;AAClC,WAAK,QAAQ,mBAAmB,QAAQ;AACxC,WAAK,QAAQ,yBAAyB,QAAQ;AAC9C,WAAK,QAAQ,uBAAuB,QAAQ;AAAA,IAC9C,WAAW,QAAQ,SAAS,0BAA0B;AACpD,WAAK,QAAQ,mBAAmB,QAAQ;AACxC,WAAK,QAAQ,yBAAyB,QAAQ,kBAAkB;AAChE,WAAK,QAAQ,uBAAuB,QAAQ;AAAA,IAC9C,WAAW,QAAQ,SAAS,eAAe;AACzC,WAAK,QAAQ,sBAAsB,QAAQ;AAAA,IAC7C,WAAW,QAAQ,SAAS,eAAe;AACzC,WAAK,QAAQ,oBAAoB,QAAQ;AAAA,IAC3C;AAAA,EACF;AAAA,EAEA,aAA2B;AACzB,WAAO,EAAE,GAAG,KAAK,QAAQ;AAAA,EAC3B;AACF;","names":[]}